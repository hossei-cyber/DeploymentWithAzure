trigger:
- main

stages:
  - stage: "BuildStage"
    jobs:
    - job: "Buildjob"
      pool:
        vmImage: ubuntu-latest
      steps:
      - task: NodeTool@0
        inputs:
          versionSpec: '20.x'
        displayName: 'Install Node.js'

      - task: Npm@1
        displayName: 'Npm Install'
        inputs:
          command: 'install'
          workingDir: '.'
      - task: ArchiveFiles@2
        inputs:
          rootFolderOrFile: '$(Build.BinariesDirectory)'
          includeRootFolder: true
          archiveType: 'zip'
          archiveFile: '$(Build.ArtifactStagingDirectory)/$(Build.BuildId).zip'
          replaceExistingArchive: true
      - task: PublishPipelineArtifact@1
        inputs:
          targetPath: '$(Pipeline.Workspace)'
          artifact: 'drop'
          publishLocation: 'pipeline'

  - stage: "DeployStage"
    dependsOn: "BuildStage"
    jobs:
    - job: 
      pool:
        vmImage: ubuntu-latest
      steps:
      - download: current
        artifact: drop
      - task: AzureRmWebAppDeployment@5
        inputs:
          ConnectionType: 'AzureRM'
          azureSubscription: 'Azure for Students(3726fb87-ee7b-42c4-a39c-d437513f686c)'
          appType: 'webAppLinux'
          WebAppName: 'project02Student'
          packageForLinux: '$(System.DefaultWorkingDirectory)/**/*.zip'
          StartupCommand: 'npm start'
          DeploymentTypeLinux: 'oneDeploy'